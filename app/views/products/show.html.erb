<main>

  <%= render "/products/shared/bread_crum" %>

  <section class="mt-8">
    <div class="container">
      <div class="row">
        <div class="col-md-6">
          <div class="product" id="product">
              <div>
                <div class="zoom" onmousemove="zoom(event)" style="background-image: url(<%= rails_storage_proxy_url(@product.watermarked_primary_image) %>)">
                  <%= image_tag @product.watermarked_primary_image, class: "img-fluid" %>
                </div>
              </div>
            <% @product.watermarked_images.each do |image| %>
              <div>
                <div class="zoom" onmousemove="zoom(event)" style="background-image: url(<%= rails_storage_proxy_url(image) %>)">
                  <%= image_tag image, class: "img-fluid" %>
                </div>
              </div>
            <% end %>
          </div>

          <div class="product-tools">
            <div class="thumbnails row g-3" id="productThumbnails">
               <div class="col-3">
                  <div class="thumbnails-img product-thumbnails">
                    <%= image_tag @product.watermarked_primary_image, class: "img-thumbnail" %>
                  </div>
                </div>
              <% @product.watermarked_images.each do |image| %>
                <div class="col-3">
                  <div class="thumbnails-img product-thumbnails">
                    <%= image_tag image, class: "img-thumbnail" %>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="ps-lg-10 mt-6 mt-md-0">
            <!-- content -->
            <a href="#!" class="mb-4 d-block"><%= @product.category_name %></a>
            <!-- heading -->
            <h1 class="mb-1"><%= @product.name %></h1>
            <div class="mb-4">
              <!-- rating -->
              <!-- rating -->
              <small class="text-warning">
                <i class="bi bi-star-fill"></i>
                <i class="bi bi-star-fill"></i>
                <i class="bi bi-star-fill"></i>
                <i class="bi bi-star-fill"></i>
                <i class="bi bi-star-half"></i>
              </small>
              <%
=begin%>
 <a href="#" class="ms-2">(30 reviews)</a>
<%
=end%>
            </div>
            <div class="fs-4">
              <!-- price -->
              <span class="fw-bold text-dark">Rs: <%= @product.price %></span>
              <%
=begin%>
 <span class="text-decoration-line-through text-muted">$35</span>
<%
=end%>
              <%
=begin%>
 <span><small class="fs-6 ms-2 text-danger">26% Off</small></span>
<%
=end%>
            <%
=begin%>
 </div>
            <!-- hr -->
            <hr class="my-6" />
            <div class="mb-5">
              <button type="button" class="btn btn-outline-secondary">250g</button>
              <!-- btn -->
              <button type="button" class="btn btn-outline-secondary">500g</button>
              <!-- btn -->
              <button type="button" class="btn btn-outline-secondary">1kg</button>
            </div>
            <div>
<%
=end%>
              <!-- input -->
              <%
=begin%>
 <div class="input-group input-spinner">
                <input type="button" value="-" class="button-minus btn btn-sm" data-field="quantity" />
                <input type="number" step="1" max="10" value="1" name="quantity" class="quantity-field form-control-sm form-input" />
                <input type="button" value="+" class="button-plus btn btn-sm" data-field="quantity" />
              </div>
            </div>
<%
=end%>
            <div class="mt-3 row justify-content-start g-2 align-items-center">
              <div class="col-xxl-4 col-lg-4 col-md-5 col-5 d-grid ">
                <!-- btn -->
                <!-- Chat Button -->
                <%= render partial: 'chats/chat_button', class: "btn btn-primary", locals: { product: @product } %>
              </div>
              <%
=begin%>
 <div class="col-md-4 col-4">
                <!-- btn -->
                <a class="btn btn-light" href="#" data-bs-toggle="tooltip" data-bs-html="true" aria-label="Compare"><i class="bi bi-arrow-left-right"></i></a>
                <a class="btn btn-light" href="shop-wishlist.html" data-bs-toggle="tooltip" data-bs-html="true" aria-label="Wishlist"><i class="feather-icon icon-heart"></i></a>
              </div>
<%
=end%>
            </div>
            <!-- hr -->
            <hr class="my-6" />
            <div>
              <!-- table -->

              <table class="table table-borderless mb-0">
                <tbody>
                <tr>
                  <td>City:</td>
                  <td><%= @product.city %></td>
                </tr>
                <tr>
                  <td>Verified:</td>
                  <td><%= @product.verified ? "Yes" : "No" %></td>
                </tr>
                </tbody>
              </table>
            </div>
            <div class="mt-8">
              <!-- dropdown -->
              <div class="dropdown">
                <a class="btn btn-outline-secondary" href="#" role="button" aria-expanded="false" id="copyLinkBtn" onclick="copyCurrentUrl(event)">Copy Link</a>

                <ul class="dropdown-menu">
                  <li>
                    <a class="dropdown-item" href="#">
                      <i class="bi bi-facebook me-2"></i>
                      Facebook
                    </a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="#">
                      <i class="bi bi-twitter me-2"></i>
                      Twitter
                    </a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="#">
                      <i class="bi bi-instagram me-2"></i>
                      Instagram
                    </a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <section class="mt-lg-14 mt-8">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <ul class="nav nav-pills nav-lb-tab" id="myTab" role="tablist">
            <!-- nav item -->
            <li class="nav-item" role="presentation">
              <!-- btn -->
              <button
                class="nav-link active"
                id="product-tab"
                data-bs-toggle="tab"
                data-bs-target="#product-tab-pane"
                type="button"
                role="tab"
                aria-controls="product-tab-pane"
                aria-selected="true">
                Ad Details
              </button>
            </li>
            <!-- nav item -->
            <li class="nav-item" role="presentation">
              <!-- btn -->
              <button
                class="nav-link"
                id="sellerInfo-tab"
                data-bs-toggle="tab"
                data-bs-target="#sellerInfo-tab-pane"
                type="button"
                role="tab"
                aria-controls="sellerInfo-tab-pane"
                aria-selected="false">
                Seller Info
              </button>
            </li>
            <!-- nav item -->
            <li class="nav-item" role="presentation">
              <!-- btn -->
              <button
                class="nav-link"
                id="viewCount-tab"
                data-bs-toggle="tab"
                data-bs-target="#viewCount-tab-pane"
                type="button"
                role="tab"
                aria-controls="viewCount-tab-pane"
                aria-selected="false">
                View Count
              </button>
            </li>
          </ul>
          <!-- tab content -->
          <div class="tab-content" id="myTabContent">
            <!-- tab pane -->
            <div class="tab-pane fade show active" id="product-tab-pane" role="tabpanel" aria-labelledby="product-tab" tabindex="0">
              <%= render 'products/shared/information' %>
            </div>
            <!-- tab pane -->
            <div class="tab-pane fade" id="details-tab-pane" role="tabpanel" aria-labelledby="details-tab" tabindex="0">
              <%= render 'products/shared/information' %>
            </div>
            <!-- tab pane -->
            <%
=begin%>
 <div class="tab-pane fade" id="reviews-tab-pane" role="tabpanel" aria-labelledby="reviews-tab" tabindex="0">
              <%= render 'products/shared/review' %>
            </div>
<%
=end%>
            <!-- tab pane -->
            <div class="tab-pane fade" id="sellerInfo-tab-pane" role="tabpanel" aria-labelledby="sellerInfo-tab" tabindex="0"><%= render 'products/shared/product_details' %></div>
            <!-- tab pane -->
            <div class="tab-pane fade" id="viewCount-tab-pane" role="tabpanel" aria-labelledby="viewCount-tab" tabindex="0">
              <div class="p-4">
                <h4>Total Views: <%= @product.view_count || 0 %></h4>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- section -->
  <%= render partial: "products/shared/related_products" %>
</main>

<div class="modal fade" id="quickViewModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body p-8">
        <div class="position-absolute top-0 end-0 me-3 mt-3">
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="row">
          <div class="col-md-6">
            <div class="product" id="product">
              <% @product.watermarked_images.each do |image| %>
                <div>
                  <div class="zoom" onmousemove="zoom(event)" style="background-image: url(<%= image_url(image) %>)">
                    <%= image_tag url_for(image) %>
                  </div>
                </div>
              <% end %>
            </div>

            <div class="product-tools">
              <div class="thumbnails row g-3" id="productThumbnails">
                <% @product.watermarked_images.each do |image| %>
                  <div class="col-3">
                    <div class="thumbnails-img product-thumbnails">
                      img
                      <%= image_tag url_for(image) %>
                    </div>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function copyCurrentUrl(e) {
    e.preventDefault();
    const url = window.location.href;
    navigator.clipboard.writeText(url).then(() => {
      const btn = document.getElementById('copyLinkBtn');
      const originalText = btn.textContent;
      btn.textContent = 'Link Copied!';
      setTimeout(() => {
        btn.textContent = originalText;
      }, 2000);
    }).catch(err => {
      console.error('Failed to copy: ', err);
    });
  }
</script>